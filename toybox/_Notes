Toy library Notes
=================

BUGS:

Check admin permissions and groups - Can't select group in user admin
Check for balance disappearing / zero?

Check potential/active -> wed/sat icons ???
Check member permission - toy retire

Toy page takes too long to load

TASKS:

TODO Cap late fee to cost of toy
TODO Add who a toy is loaned to to table and summary

TODO On login include shift volunteer names. Put on Login page for successful login or new default page?.
TODO On login allow volunteers to enter in till amount. Does this has to be on login?
TODO On logout Volunteer enters till amount.  Is the till actually altered? - New Page

TODO Repair fee calculation to be updated-waiting on Elizabeth

CANT FIX:
Toys	Search function in Toys not limiting enough. If you put "I" in it will search on all toys that have the letter "I" in the title. It doesn't search on just imagination toys.
    Can't reproduce in toys page - I shows all toy ids with I - all imagination - Can also use category dropdown.

Borrow	Borrow fee update didn't work
    Can't reproduce, assume loan duration change

KNOWN LIMITATIONS:
chrome doesn't support exif  CSS rotation-from-image - check tablets

MINOR:
TODO Toy admin help text
TODO Add help text to transaction buttons in borrow page
TODO Add help text to toy buttons
TODO Auto focus member search after clear form on borrow page
TODO Auto focus member search on returns page

TODO Check borrow fields for bad inputs
TODO check UI alignments on return and borrow pages
TODO Check fee adjust for bad chars or no entry
TODO Check admin for fields that should be readonly and permissions
    -Delete toy and member shouldn't be allowed

BIGGER ITEMS:
TODO migrate to production database - postgres
TODO Backup - use other laptops for backup?
TODO OS of server - windows 7



COMPLETE:
Borrow	If you hit return after typing in the payment, it removes a toy from the list.
Image table in admin - Add button in toy admin missing? Also no image table
Top menu not working on mobile phone - could not reproduce
Members	Add new member gets error message
Members	update button in members isn't working. Mia tried to update partner name and got an error message
Members	Adding member broke it KeyError at /toybox/members/ 'deposit_fee_paid' Request Method: POST Request URL: http://127.0.0.1/toybox/members/ Django Version: 1.8.3 Exception Type: KeyError Exception Value: 'deposit_fee_paid' Exception Location: C:\toylibrary\treasurechest\toybox\views\members.py in save, line 120 Python Executable: c:\python27\python.exe Python Version: 2.7.1 Python Path: ['C:\\toylibrary\\treasurechest', 'C:\\Windows\\system32\\python27.zip', 'c:\\python27\\DLLs', 'c:\\python27\\lib', 'c:\\python27\\lib\\plat-win', 'c:\\python27\\lib\\lib-tk', 'c:\\python27', 'c:\\python27\\lib\\site-packages'] Server time: Sat, 19 Mar 2016 13:06:14 +1100
breaks when no transactions in table - tries to get latest one for daily balance
Link Toy history and transaction - list toy Id in transaction. Display toys in transaction - tricky?
Add list to show a members toy history!!! - Add to member page
Add Comment field for member
Hide balance and all credit functions instead of disabling. Including credit button and Amount to pay and total to pay
Hide donate button thru config
Members	Calendar not working - fixed
Combine Exact and change button - call it Paid
Hide Loan Bond - disable with config
Add issue fees for return
     lost toy fee - just a hint? how many weeks has it been borrowed - earned back its cost?
     broken fee - has to be repaired - donation - calculate suggestion?? 10% of cost, sliding scale from 50% reducing every borrow.
     missing toy fee - same as broken.
     major missing piece fee - open - manual transaction for refund?
Merge import data for toys - add in test_data that makes sense
Fix double title bar in ie
Rotated Images in toy summary
Add loan_bond to possible fees - ok on borrow side, TODO return side
Remove loan type table, Add loan_cost and loan_bond to toy table
Add disable of credit function in borrow page - set in config table - disable credit button, set all credit to 0

Add repairer membertype -
    - "Repairer only" membertype - no annual fees
    - member type - can repair flag - due date
        - toy has not fees, show only repair checkbox for those with repairer flag. Not included in max toy limit
    - Add for repair checkbox in borrow toy list

Feedback - change to logged in user
Add children to members page - birth month and year only - Almost done
Add reporting plugin
exclude retired toys from toy list
Permissions for toy retire, member delete, banking and till change - member delete (not active) performed in admin
Add logged in volunteer to multiple tables: toy history and transaction
Member import data
Merge volunteer login
Add login roles? Start with volunteer and admin
members inactive - don't display in member table
bond fee amount for refund
when banking set banking amount.
Add instruction and receipt images - display with extra click from toy summary
Enable checked checkbox function in toys for stocktake - Done
Update till balance - done
include balance in transactions - done
Add transaction actions such as banking (resets till balance) and adding to till - Done
Column filter for toy list - done
Column filter for toy history - done
Column filter for member list - sort by overdue colour? - Add extra character - done
Clear temp borrow list if page is left - partially complete, fails if you open another borrow window - forces only one borrower at a time - could be issue down the track
Save adjustment justification comment in transactions - done. one issue that if you update it more than once the original value isn't recorded in the transaction comment
Add ability to update issue type, issue comment
Add ability to set all toys to stocktake state
Add volunteer capacity - wed and sat boolean

NEXT RELEASE:
Better toy selection - is very slow, resets filtering
When adding toy suggest loan fee
All Max children displayed to be change or add + button
Dealing with low income earner
Comment when toy is retired
Enable donation - could be done with what we have?

Add on loan >6 months sets toy as retired - include in config table
Pagination of transactions, members, toy, toy history to be done on server side.
Member availability-Is this useful given no scheduling? Below to do in model:
    # roster days - bitfield?
    # member notes/characteristics?
Membership annual fee warning
Add member delete (change status to removed, all member queries will have to exclude removed members) - need to add status or removed flag
Link transaction to toy history some how
Set toy add in admin in order of those fields required for adding toys manually.
email, for receipt - later, more useful for toy reminders. Start with receipt number?


Model
-----

# loan type needs some thought, regarding missing pieces and the issue register
# loan period may not be needed, or set to zero if not fixed?
# Removed member type, a toy can have only one loan type so different member type doesn't make sense
# overdue fine - per week?
# I think this can this be combined with Toy category.
# Is the main difference between the cost of loan the type of toy?

* Do you want rostered days recorded - what will you do with them? - report?

# should there be a borrow register, what about the history of the toy, how popular is it?
# This is a report they are interested in.
# this would be instead of recording the member, due date etc in the toy record. Not sure about state.

* Add toy_transaction table, used only for reporting. keep current fields.
    toy transaction type
    time stamp
    member
    toy
    overdue days/weeks

Transaction:
do we need toy link? no
add balance filled back in


Loan type:
How do you handle increasing toy rent fees?
Loan period is this ever fixed? what is the max? what is the default?
fines? for missing toy? cost of toy is captured in toy table
defaults?

Buckets of money? member balance, member membership balance, transactions

Home Page
---------
* What information is useful on the title bar? add number of members have borrowed, total toys
* Is daily balance useful? yes
* volunteers info on page
* DB message admin can change

Borrow Page
----------
* What details of the member should be displayed in the summary? add partner - done
* membership, 6 months or year, default 1 year - done
* Do the members have a balance? to be confirmed.
* Should partner name also be searched? yes - done
* Max loan duration? 1&2 for normal login, other available for admin login - max 10 weeks max selectable via dialog box - limit to 1&2 - other yet to do
* Default loan duration? 2 weeks - done
* What details of the toy should be displayed? min age, category, comment, issue type and issue comment - obvious - done except toy_issue
* Should there be a toy search/lookup option? yes add magnifier icon to toy page
* What information is useful in the borrowed toy table? ok as is
* Prefer to hide unused sections until they are relevant? ok as is
* Due in display days/weeks/date? fine, week overdue fine only. ok as is
* Do you borrow all toys for the same duration? yes ok as is
* How are fees collected/calculated. do you need extra calculations, change given, donation, other fees
* overdue fee vs balance? how is balance worked out. ok
* extra credit given? No
 donation,
 late fee,
 borrow fee
 broken fee
 missing toy fee
 missing piece fee

- combine toy register and issue register into toy history table.
 payment area done at borrow page
 any override should come with reason. override is a little harder to do.


 * can't complete borrow on negative balance
* pay ?
* Regarding Borrow use case:
    System calculates fee and volunteer communicates fee to member
    The fee should include the cost to borrow the toys and membership fee and late fees

borrow transaction table - have individual overrides
reason textbox with button to populate with "volunteer borrow"

* Does anyone ever need change? how would you like to address this? yes, change given button
* Add comment for toy, in toy summary - done

Return Page
-----------
* What details of the member should be displayed in the summary?, same as borrow - done
* What information is useful in the borrowed toy table? ok as is
* non paid late fees? - ok can't borrow with neg credit

Member Page
-----------
* Two phone numbers? yes, ok as is
* display in list? - valid membership, sort by this - done
* Roster - how would this be used? - forgot to ask
* Membership payment? i'll think of something fee attached to member
* bond payment separate bucket attached to member - added bond and membership fee decimal fields to model - to be captured in transaction register.

add remove member

Transaction Page
----------------
*TODO
email, for receipt - later, more useful for toy reminders. Start with receipt number

Reports Page
------------
*TODO

TOY LIST PAGE -yes
-------------
Primarily for stock take, check box and report issue option.
filter? sort? lookup select?
toy search, filter for stock take and toy lookup

Internal Discussion
===================

change loan type to loan fees

membership fee yearly $20
bond one per member $30 currently

Explain multiple toy codes with letters - pick image with most information - provide blow up of image - DONE

Skype with elizabeth

* Fees:
- Issue fees:
     lost toy fee - just a hint? how many weeks ahs it been borrowed - earned back its cost?
     broken fee - has to be repaired - donation - calculate suggestion?? 10% of cost, sliding scale from 50% reducing every borrow.
     missing toy fee - same as broken.
     major missing piece fee - open - manual transaction for refund?

- borrow toy fee - 1% cost rounded up to nearest 50c. Suggested fee. damaged may change the fee - suggested fees. In spreadsheet??? - in book In folder inventory, 2013 onwards MTB inventory.
- yearly membership fee - defined
- donation - open
- late fee - cost to borrow by number of weeks borrowed - must be able override
- joining bond/bond - fixed to $30 current, presented in borrow toys

* bond refund - form filled out and it's mailed or direct debit. Linda. Ideally properly tracked by this system.


Open questions:

Mechanism for paying for return fees at borrow table:
    toy history records issue, add transaction field, if null and member and issue add them in



Admin
new toy cost? should this be recorded as a transaction - if so what bucket does come out of?
    members buy toys, treasurer refunds the cost - transaction of PAYMENT? To be recorded in toy itself as well

Questions on commitee,

* Add Receipt image
* Add Instruction image


TOY LIST COLUMNS? Add # of weeks borrowed, checklist for stocktake for each toy?
Link to toy history  and toy details - view only
Toy history - new page, modal? what about exporting - report only?


  - each fee generates its own transaction
  - each transaction can have a comment
  - link to toy history?  - toy history links to transaction

   DONATION = 0
    BOND_REFUND = 1
    PETTY_CASH_ADJUSTMENT = 2
    FROM_BANK = 3
    CREDIT_ADJUSTMENT = 4
    CHARGE_REVERSAL = 5
    PAYMENT = 6
    MEMBERSHIP = 7
    HIRE_CHARGE = 8
    FEE = 9
    FINE = 10
    DEBIT_ADJUSTMENT = 11
    REFUND = 12
    TO_BANK = 13
    BOND = 14

* add stocktaked state
* on loan for > 6 months - retired
* major missing piece - admin cupboard
* Need mechanism to lend to a repair agent - loan type, if returned assumed repaired? or unable to repair - may not be a member
* retire reason comment


TODO put in real test case
search toy test cases

Borrow toy B1 to Alice
Set P5 to unavailable thru admin


exact match: I13 -> add to temp list - ok
name with one entry: train -> add to temp list - ok
name with multiple entries: e -> list displayed, select one ->added to temp list - ok - if already borrowed, state is wrong
name not found: qwerty -> error toy not found - ok
name already borrowed by member: I13 -> error toy borrowed - ok
toy already borrowed by other member: B1 -> error toy borrowed - ok
toy set to unavailable: P5 -> error toy unavailable - ok
blank name -> error toy not entered - ok
delete borrowed toy -> removed from list - toy code not entered error


* Toy code isn't unique - stop assuming it is! use the id - Done

(+ or - indicates adding or subtracting from the till)
MEMBER_DONATION         + From member to toy library. Automatic in Borrow page.
MEMBER_CREDIT           + From member to add to their credit amount. Added to till. Automatic from borrow page
MEMBER_bond          + From member to toy library on membership sign up. Automatic from borrow page
MEMBERSHIP_FEE          + Member annual membership fee. Automatic from borrow page
BORROW_FEE              + Member borrows toy. Automatic from borrow page
ISSUE_FEE               + Member returns toy with notable issue. Automatic from returns page
OVERDUE_FEE             + Member borrow overdue fee. Automatic from returns page

ADJUSTMENT_CREDIT       + Adjustment of till. Manual from transactions page
ADJUSTMENT_DEBIT        - Adjustment of till. Manual from transactions page
BANK_bond            - End of day take money to bank. Manual from transactions page
MEMBER_bond_REFUND   - From toy library to member once they cancel their the toy library membership. Manual from transaction page


FROM_BANK
CHARGE_REVERSAL = 5
REFUND = 12


meeting with nathan 2/12/2015
Gender is entered for children but not for toys. should we neither or both? - gender not required
Do toys get retired if they are never borrowed? - yes, by commitee member at stocktake
who should have authority to retire toys? - commitee member - admin
Member type: member, volunteer, play group, low income?
remove membership fee from member, replace with below - done
rename anniversary_date to paid_until_date - done
Member types/roles?
add role field to member?
    repairer
    admin
    treasurer
    stocktaker
    admin
    
