<!--
inputs:
Member_status - boolean (true for valid, false for overdue)
Member_balance - decimal
issue_list - Dict for report issue, "issue":string and "value":integer pairs
toys_borrowed - Tuples of Dict: "ID":string, "name":string, "due_in":integer, "issue":integer
-->


{% extends "toybox/base.html" %}
{% load templatetags %}
{% block content %}


   <h1  class="page-header">Return Toy</h1>

        <div class="row">
			 <div   class="col-xs-12 col-sm-10 ">
                 {% include "toybox/member_search.html" with return_page="/toybox/returns" %}
                  {% include "toybox/member_search_select.html" with return_page="/toybox/returns"%}
              </div>
        </div>

        <div class="row" style="margin-left: 10px;">
              <div class="col-xs-12 col-sm-10 " >
                  <br>
                  {% include "toybox/member_summary.html" %}
                  <br>
              </div>
        </div>

        <div   class="col-sm-8 col-xs-12 " style="margin-left: 20px;">
            {% if toy != None %}
                 {% include "toybox/toy_summary.html" %}
            {% endif %}
       </div>

        <div class="row">
             <div class="panel-fluid panel-default col-xs-12 col-sm-10 ">
              <!-- Default panel contents -->
              <div class="panel-heading">Borrowed Toys</div>

              <!-- Table -->
              <table id="toy_table" class="table">

                    <thead>
                        <tr>
                             <th>Toy ID</th>
                        	<th>Toy Name</th>
                            <th>Due</th>
                            <th id="fee">Fee</th>
                            <th id="returned">Returned</th>
                            <th>Report Issue</th>
                            <th>Comments</th>
                       	</tr>
                    </thead>

                   {% for toy in toy_list %}
                   <tr>
                        <td>
                            <a href="{% url 'toybox:returns' %}{{member.id}}/?tc={{toy.code}}">{{ toy.code }}</a>
                        </td>

                        <td>
                            {{ toy.description }}
                        </td>

                        <!--TODO add issue fee to overdue fee-->
                        <td>
                           <span class="label {% if toy.due_date|timebetween|slice:':1' == '-' %} label-danger {%else%} label-success {%endif%} label-as-badge">{{ toy.due_date|timebetween }}</span>
                        </td>

                       {% if toy.due_date|timebetween|slice:':1' == '-' %}
                            <td value="{{ toy.loan_type.overdue_fine|floatformat:2 }}">
                                ${{ toy.loan_type.overdue_fine|floatformat:2 }}
                            </td>
                       {%else%}
                            <td value="0.00">
                                $0.00
                            </td>
                       {%endif%}

                        <td>
                           <input type="checkbox" id="returned_checkbox_{{ toy.ID }}" onclick="handleCheckbox(this);"/>
                        </td>

                        <td>
                            <!--<div class="selectContainer">-->
                                <select class="form-control" name="issue">
                                 {% for issue in issue_list %}
                                    <option value="{{ issue.0 }}" {% if toy.issue_type == issue.0 %}selected{% endif %} > {{ issue.1 }} </option>
                                 {% endfor %}
                                </select>
                            <!--</div>-->
                        </td>

                        <td>
                            <input class="form-control" href="#">
                        </td>

                     </tr>
                     {% endfor %}
              </table>
            </div>

</div>

<script>
    function handleCheckbox(cb)
    {
        var table = document.getElementById("toy_table");
        var total= 0.0;
        var checkboxCol=document.getElementById("returned").cellIndex;
        var feeCol=document.getElementById("fee").cellIndex;

        for (var i = 1, row; row = table.rows[i]; i++)
        {
            if (row.cells[checkboxCol].getElementsByTagName('input')[0].checked)
            {
                total+=parseFloat(row.cells[feeCol].getAttribute("value"));
            }
        }
        document.getElementById("fee_due").value=total.toFixed(2);
    }
</script>

<div class="row">
         <div class="input-group col-xs-12 col-sm-10 ">
              <span class="input-group-addon">Fee Due $</span>
              <input type="text" id="fee_due" class="form-control" aria-label="Amount ">
               <span class="input-group-btn">
        			<button class="btn btn-default" type="button">Done</button>
      		   </span>
            </div>
</div>
{% endblock content %}
