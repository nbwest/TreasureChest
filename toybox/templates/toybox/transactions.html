{% extends "toybox/base.html" %}
{% load widget_tweaks %}
{% block content %}
<span id="transactions">

<h1  class="page-header">Transactions</h1>


<form role="form" action="{{ request.get_full_path }}" class="form-group" method='post' onsubmit="return validate(this);">
    {% csrf_token %}

     <div class="row panel-default col-xs-12 col-sm-11 ">

         {%if transaction_form %}
            <div class="panel-heading">Actions</div>
         {%endif%}

         {% for field in transaction_form%}
              <br>
                <div class=" input-group" >
                    <span class="input-group-addon">{{field.label_tag|striptags}}</span>
                    {% render_field field class+="form-control" id=field.auto_id %}

                    <span class="input-group-btn">
                        {% for key, value in field.field.widget.attrs.items %}
                            {% if "button" in key %}
                                <button type="submit" class="btn btn-default" value="{{key}}" name="{{key}}" data-toggle="modal" >{{value}}</button>
                            {% endif %}
                        {% endfor %}
                    </span>


                </div>


                 <ul  style="list-style-type:none;list-style:none;padding-left:0;">
                {% for error in field.errors  %}
                    <li><label class="label label-danger">{{ error|striptags }}</label></li>
                {% endfor %}
                </ul>
            {% endfor %}
     </div>

    <div class="row col-xs-12" style=" min-height: 20px;"  >
    </div>

</form>


{% if transactions %}

    <div class="row col-xs-12 col-sm-11 " style=" min-height: 40px;"  >
        <div class="panel-default">
            <div class="panel-heading">Transaction History</div>
     <table  data-classes="table table-condensed table-no-bordered"
             data-toggle="table"
             data-filter-control="true"
             id="transaction_table"
             data-sort-name="id"
             data-sort-order="desc"
             data-search="true"
             data-show-columns="true"
             data-pagination="true"
             data-page-size="20"
             data-page-list='[20, 50, 100, 200, 300, 500]'
             data-show-pagination-switch="true"
             data-show-export="true"
             data-export-types="['excel','csv']"
             data-escape="false"
             data-cookie="true"
             data-cookie-id-table="transaction_table">
             <thead>
                <tr>
                    <th data-field="id" data-sortable="true" data-filter-control="input">ID</th>
                    <th data-field="date_time" data-sortable="true" data-filter-control="datepicker" data-filter-datepicker-options='{"format":"dd/mm/yyyy", "autoclose":true, "clearBtn": true, "todayHighlight": true, "todayBtn": "linked",  "orientation": "bottom auto"}'>Date</th>

                    <th data-field="transaction_type"  data-sortable="true" data-filter-control="select">Type</th>
                    <th data-field="member"  data-sortable="true" data-filter-control="input">Member</th>
                    <th data-field="toys"  data-filter-control="input">Toys</th>
                    <th data-field="volunteer"  data-sortable="true" data-filter-control="input">Volunteer</th>
                    <th data-field="amount" data-sortable="true"  >Amount</th>
                    <th data-field="balance" data-sortable="true">Balance</th>
                    <th data-field="comment"  data-filter-control="select" data-sortable="true">Comment</th>
                    <th data-field="complete" data-visible="false"  data-filter-control="select" data-sortable="true">Complete</th>
                </tr>
            </thead>

            {% for transaction in transactions %}
              <tr>
                    <td>{{transaction.id}}</td>

                    <td>
                        <span name='{{transaction.date_time|date:"Y/m/d H:i:s"}}'></span>
                        {{transaction.date_time|date:"d/m/Y H:i"}}
                    </td>
                    <td>{{transaction.get_transaction_type_display}}</td>


                    <td>
                        <a name="{{transaction.member}}"{%if transaction.member %} href="{% url 'toybox:members' transaction.member.id %}" {%endif%}>
                            {{transaction.member}}
                        </a></td>

                    <td>
                        {% for th in transaction.toyhistory.all %}
                            <a href="{% url 'toybox:toys' toy_id=th.toy.id %}">
                                {{th.toy.code}}: {{th.toy.name}}<br>
                            </a>
                        {%endfor%}
                    </td>
                    <td>{{transaction.volunteer_reporting}}</td>
                    <td>{{transaction.amount}}</td>
                    <td>{{transaction.balance}}</td>
                    <td>{{transaction.comment}}</td>
                    <td>{{transaction.complete}}</td>


              </tr>
            {% endfor %}

            </table>
        </div>
    </div>
{% endif %}

</span>

<script>


$(document).ready(function() {
var $table = $('#transaction_table');
$table.bootstrapTable('refreshOptions', {
    exportOptions: {
        onCellHtmlData: DoOnCellHtmlData
    }
});
});
</script>


{% endblock content %}
