{% extends "toybox/base.html" %}
{% load widget_tweaks %}
{% block content %}
<span id="transactions">

<h1  class="page-header">{{title}}</h1>


<form role="form" action="{{ request.get_full_path }}" class="form-group" method='post' onsubmit="return validate(this);">
    {% csrf_token %}

     <div class="row panel-default col-xs-12 col-sm-11 ">

         {%if transaction_form %}
            <div class="panel-heading">Actions</div>
         {%endif%}

         {% for field in transaction_form%}
              <br>
                <div class=" input-group" >
                    <span class="input-group-addon">{{field.label_tag|striptags}}</span>
                    {% render_field field class+="form-control" id=field.auto_id %}

                    <span class="input-group-btn">
                        {% for key, value in field.field.widget.attrs.items %}
                            {% if "button" in key %}
                                <button type="submit" class="btn btn-default" value="{{key}}" name="{{key}}" data-toggle="modal" >{{value}}</button>
                            {% endif %}
                        {% endfor %}
                    </span>


                </div>


                 <ul  style="list-style-type:none;list-style:none;padding-left:0;">
                {% for error in field.errors  %}
                    <li><label class="label label-danger">{{ error|striptags }}</label></li>
                {% endfor %}
                </ul>
            {% endfor %}
     </div>

    <div class="row col-xs-12" style=" min-height: 20px;"  >
    </div>

</form>




    <div class="row col-xs-12 col-sm-11 " style=" min-height: 40px;"  >
        <div class="panel-default">
            <div class="panel-heading">Transaction History</div>
     <table  data-classes="table table-condensed table-no-bordered"
             data-toggle="table"
             data-filter-control="true"
             id="transaction_table"
             data-sort-name="id"
             data-sort-order="desc"
             data-show-columns="true"
             data-pagination="true"
             data-page-size="20"
             data-page-list='[20, 50, 100, 200, 300, 500]'
             data-show-pagination-switch="true"
             data-show-export="true"
             data-export-types="['excel','csv']"
             data-escape="false"
             data-cookie="true"
             data-cookie-id-table="transaction_table"
             data-url="{{ request.get_full_path }}"
             data-pagination="true"
             data-side-pagination="server">


             <thead>
                <tr>
                    <th data-field="id" data-filter-control="input" data-sortable="true">ID</th>
                    <th data-field="date_time" data-sortable="true" data-sorter="dateSorter" data-filter-control="datepicker" data-filter-datepicker-options='{"format":"dd/mm/yy", "autoclose":true, "clearBtn": true, "todayHighlight": true, "todayBtn": "linked",  "orientation": "bottom auto"}'>Date</th>
                    <th data-field="transaction_type"  data-sortable="true" data-filter-control="select" data-filter-data="url:{{ request.get_full_path }}?filter_data=transaction_type">Type</th>
                    <th data-field="member_id"  data-sortable="true" data-filter-control="input">Member</th>
                    <th data-field="toys" >Toys</th>
                    <th data-field="volunteer_reporting"  data-sortable="true" data-filter-control="input">Volunteer</th>
                    <th data-field="amount" data-sortable="true"  >Amount</th>
                    <th data-field="balance" data-sortable="true">Balance</th>
                    <th data-field="comment"  data-filter-control="input" data-sortable="true">Comment</th>
                    <th data-field="complete" data-visible="false"  data-filter-control="select" data-sortable="true" data-filter-data="url:{{ request.get_full_path }}?filter_data=complete">Complete</th>
                </tr>
            </thead>


        </table>
    </div>
</div>


</span>

<script>


$(document).ready(function()
{
    var $table = $('#transaction_table');
    $table.bootstrapTable('refreshOptions',
    {
        exportOptions:
        {
            onCellHtmlData: DoOnCellHtmlData
        }
    });



    function parseDate(input)
    {
      var parts = input.split('/');
      return new Date(parts[2], parts[1]-1, parts[0]);
    }

     function dateSorter(a, b)
     {
            dateA=parseDate(a);
            dateB=parseDate(b);

            if (dateA > dateB) return 1;
            if (dateA < dateB) return -1;
            return 0;
    }

});

</script>


{% endblock content %}
