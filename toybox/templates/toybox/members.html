
{% extends "toybox/base.html" %}
{% load widget_tweaks %}
{% load templatetags %}
{% block content %}

{% include "toybox/toy_summary_popup.html" %}
{% include "toybox/member_toy_history_popup.html" %}
{% include "toybox/member_edit_popup.html" %}



{%if success%}
    {% include "toybox/notification_message.html" with type="success" title="Success!" message="Transaction sucessful" %}
{%endif%}

{%if failure%}
    {% include "toybox/notification_message.html" with type="danger" title="Failure!" message="Check for invalid field entries" %}
{%endif%}

<h1  class="page-header">{{title}}</h1>






<div class="row">

    <div class="panel-fluid panel-default col-xs-12 col-sm-11">
              <!-- Default panel contents -->
         <div class="panel-heading">Member List</div>

        <div id="toolbar">

            <button title="Add New Member" type="button" class="btn btn-success" aria-label="Left Align" onclick="getMemberDetails(this);" value="add">
            <span class="glyphicon glyphicon-plus " aria-hidden="true"></span><span class="glyphicon glyphicon-user " aria-hidden="true"></span> Add new member</button>
        </div>



            <table  id="member_table"
                    data-show-export="true"
                    data-export-types="['excel','csv']"
                    data-classes="table table-condensed table-no-bordered"
                    class="table table-condensed"
                    data-filter-control="true"
                    data-toggle="table"
                    data-toolbar="#toolbar"
                    data-sort-name="name"
                    data-sort-order="asc"
                    row-height="20"
                    data-search="true"
                    data-show-columns="true"
                    data-pagination="true"
                    data-page-size="20"
                    data-page-list='[20, 50, 100, 200, 300, 500]'
                    data-cookie="true"
                    data-cookie-id-table="member_table"
                    data-show-pagination-switch="true"
                    data-escape="false">


                    <thead>
                        <tr>
                            <th data-field="loans"  data-sortable="true" >Loans</th>
                        	<th data-field="name"  data-sorter="aTagSorter" data-sortable="true" data-filter-control="input">Name</th>
                            <th data-field="status"  data-sortable="true" data-filter-control="select">Status</th>
                            <th data-field="phone"  data-sortable="true" data-filter-control="input">Phone</th>
                            <th data-field="email"  data-sortable="true"data-filter-control="input">Email</th>
                            <th data-field="balance"  data-visible="false" data-sortable="true">Balance</th>
                            <th data-field="wed"   data-visible="false" data-sortable="true" data-filter-control="select">Wed</th>
                            <th data-field="sat"   data-visible="false" data-sortable="true" data-filter-control="select">Sat</th>
                            <th data-field="volunteer"   data-visible="false" data-sortable="true" data-filter-control="select">Active<br>Volunteer</th>
                            <th data-field="committee"   data-visible="false" data-sortable="true" data-filter-control="select">Committee<br>Member</th>
                            <th data-field="bond"  data-visible="false" data-sortable="true">Bond</th>
                            <th data-field="membership_receipt_reference"  data-visible="false" data-sortable="true" data-filter-control="input">Membership Receipt #</th>
                       	</tr>
                    </thead>

                    {% for m in members %}

                    <tr>
                         <td class="text-center">


                               {% spaceless %}
                                   {% if m.id not in loan_counts %}
                                        <a name="0" href="{% url 'toybox:returns' member_id=m.id %}">
                                            <span class="label label-default label-as-badge" title="No loans">0</span>
                                        </a>
                                   {%else%}
                                        {% for key, value in loan_counts.items %}
                                            {% if key == m.id %}
                                                    {% if m.id in loans_overdue %}
                                                        <a name="{{value}}" href="{% url 'toybox:returns' member_id=m.id %}">
                                                            <span class="label label-danger label-as-badge" title="Overdue loans - click to go to returns">{{ value }}</span>
                                                        </a>
                                                    {%else%}
                                                        <a name="{{value}}" href="{% url 'toybox:returns' member_id=m.id %}">
                                                            <span class="label label-success label-as-badge" title="Loans - click to go to returns">{{ value }}</span>
                                                        </a>
                                                    {% endif %}

                                            {% endif %}
                                        {% endfor %}
                                   {%endif%}
                               {% endspaceless %}

                             <button title="Toy History" type="button" class="btn btn-link" onclick="getMemberToyHistory(this);" value="{{m.id}}">
                                    <span class="glyphicon glyphicon-time " aria-hidden="true"></span>
                                </button>
                           </td>

                            <td>

                                <button title="Edit member details" type="button" class="btn btn-link" onclick="getMemberDetails(this);" value="{{m.id}}">
                                        {{ m.name }}
                                </button>
                                <!--<a  name="{{ m.name }}" href="{% url 'toybox:members' member_id=m.id %}{{action}}">-->
                                <!--</a>-->
                            </td>

                            <td class="text-center">
                                {% if m.is_current %}
                                    {%if m.member_warning %}
                                        <span class="label label-warning label-as-badge">Upcoming</span>
                                    {% else %}
                                        <span class="label label-success label-as-badge">Valid</span>
                                    {% endif %}
                                {% else %}
                                    <span class="label label-danger label-as-badge">Due</span>
                                {% endif %}
                            </td>





                        <td>{{m.phone_number1}}</td>
                        <td>{{m.email_address}}</td>

                        <td class="text-center">
                            ${{m.balance|floatformat:2}}
                        </td>

                        <td class="text-center">
                            {% spaceless %}
                                {% if m.volunteer %}
                                    <span class="hidden">{{m.volunteer_capacity_wed}}</span>
                                    {% if m.volunteer_capacity_wed %}
                                        <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
                                    {% else %}
                                        <span class="glyphicon glyphicon-remove text-danger" aria-hidden="true" ></span>
                                    {% endif %}
                                {% else %}
                                    <span class="hidden">Inactive</span>
                                    <span class="glyphicon glyphicon-ban-circle text-danger" aria-hidden="true" ></span>
                                {% endif %}
                            {% endspaceless %}
                        </td>
                        <td class="text-center">
                             {% spaceless %}
                                {% if m.volunteer %}
                                    <span class="hidden">{{m.volunteer_capacity_sat}}</span>
                                    {% if m.volunteer_capacity_sat %}
                                        <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
                                    {% else %}
                                        <span class="glyphicon glyphicon-remove text-danger" aria-hidden="true" ></span>
                                    {% endif %}
                                {% else %}
                                    <span class="hidden">Inactive</span>
                                    <span class="glyphicon glyphicon-ban-circle text-danger" aria-hidden="true" ></span>
                                {% endif %}
                            {% endspaceless %}
                        </td>
                        <td class="text-center">
                             {% spaceless %}

                                    <span class="hidden">{{m.volunteer}}</span>
                                    {% if m.volunteer %}
                                        <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
                                    {% else %}
                                        <span class="glyphicon glyphicon-remove text-danger" aria-hidden="true" ></span>
                                    {% endif %}

                            {% endspaceless %}
                        </td>
                        <td class="text-center">
                            {% spaceless %}
                                    <span class="hidden">{{m.committee_member}}</span>
                                    {% if m.committee_member %}
                                        <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
                                    {% else %}
                                        <span class="glyphicon glyphicon-remove text-danger" aria-hidden="true" ></span>
                                    {% endif %}
                            {% endspaceless %}
                        </td>
                        <td class="text-center">
                            ${{m.bond_fee_paid|floatformat:2}}
                        </td>
                        <td>{%if m.membership_receipt_reference %}{{m.membership_receipt_reference}}{%endif%}</td>
                       </tr>
                    {% endfor %}
            </table>

      </div>



    <!--<div class="panel-fluid panel-default col-xs-12 col-sm-4 " style="text-align: left; vertical-align: middle; border-left: 1px solid #ccc ">-->
        <!-- -->

    <!--</div>-->


</div>



<script>
$(document).ready(function() {

 $('.date')
        .datepicker({
            format: 'dd/mm/yyyy',
            autoclose:'true',
            clearBtn:'true',
            todayHighlight:'true',
            todayBtn: 'linked',
            orientation: 'auto'

        })

});


$(document).ready(function() {
var $table = $('#member_table');
$table.bootstrapTable('refreshOptions', {
    exportOptions: {
        onCellHtmlData: DoOnCellHtmlData
    }
});
});

function aTagSorter(a,b)
 {
    var textA = $(a).text();
    var textB = $(b).text();

    if (textA > textB) return 1;
    if (textA < textB) return -1;
    return 0;

 }


</script>
{% endblock content %}