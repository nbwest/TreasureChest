
{% extends "toybox\base.html" %}
{% load widget_tweaks %}

{% block content %}
<h1  class="page-header">Members</h1>


<!--<div id="member" class="row" >-->

    <!--<div   class="col-xs-11 col-sm-10">-->
           <!--{% include "toybox/member_search.html" with return_page="/toybox/members"%}-->
        <!--<br>-->

    <!--</div>-->

<!--</div>-->

<div class="row">



    <div class="panel-fluid panel-default col-xs-11 col-sm-4">
              <!-- Default panel contents -->
         <div class="panel-heading">Member List</div>


            <!--<table id="member_table" class="table">-->
            <table  id="member_table" class="table table-condensed"  data-toggle="table"  data-sort-name="name" data-sort-order="desc" row-height="20" data-search="true" showColumns="true" data-show-columns="true" data-pagination="true" data-page-size="20"  data-page-list='[20, 50, 100, 200, 300, 500]'>

                    <thead>
                        <tr>
                        	<th data-field="name"  data-sortable="true">Name</th>
                            <th data-field="status"  data-sortable="true">Status</th>
                            <th data-field="loans"  data-sortable="true">Loans</th>
                       	</tr>
                    </thead>

                    {% for m in members %}
                       <tr>

                            <td>
                                <!--{{ m.name }} Due to href breaking sorting, keep this comment here - this is what is sorted by-->
                                <a  href="{% url 'toybox:members' member_id=m.id %}{{action}}">
                                    {{ m.name }}
                                </a>
                            </td>

                            <td>
                                {% if m.is_current %}
                                <span class="label label-success label-as-badge">Valid</span>
                                {% else %}
                                <span class="label label-danger label-as-badge">Not Current</span>
                                {% endif %}
                            </td>

                           <td>
                               <!-- Due to href breaking sorting, keep these comments here - this is what is sorted by-->

                               <!--{% for key, value in loan_counts.items %}-->
                                            <!--{% if key == m.id %}                                              -->
                                                   <!--{{ value }}                                              -->
                                            <!--{% endif %}-->
                                       <!--{% endfor %}-->

                               <a href="{% url 'toybox:returns' member_id=m.id %}">
                                   {% if m.id not in loan_counts %}
                                    <span class="label label-success label-as-badge">0</span>

                                   {%else%}
                                       {% for key, value in loan_counts.items %}
                                            {% if key == m.id %}
                                                {% if m.id in loans_overdue %}
                                                    <span class="label label-danger label-as-badge">{{ value }}</span>
                                                {%else%}
                                                   {{ value }}
                                                {% endif %}
                                            {% endif %}
                                       {% endfor %}
                                   {%endif%}
                                </a>

                           </td>

                       </tr>
                    {% endfor %}
            </table>
      </div>

     <div   class="col-xs-1" >

        <a href="{% url 'toybox:members' %}"><button title="Clear fields to add New Member" type="button" class="btn btn-success" aria-label="Left Align">
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span><span class="glyphicon glyphicon-user " aria-hidden="true"></span></button></a>

    </div>


    <div class="panel-fluid panel-default col-xs-12 col-sm-5 " style="text-align: left; vertical-align: middle; ">

        <form role="form" action="{{ request.get_full_path }}" class="form-group" method='post'>
            {% csrf_token %}
            <div class="fieldWrapper" >
            {% for field in member_details_form %}
                {{ field.label_tag }}

                {% render_field field class+="form-control" %}

                <ul  style="list-style-type:none;list-style:none;padding-left:0;">
                    {% for error in field.errors  %}
                        <li><label class="label label-danger">{{ error|striptags }}</label></li>
                    {% endfor %}
                </ul>

            {% endfor %}

                <br>

                {%if member_detail_submit_button_label == "Add" %}
                    <button type="submit" name="add" class="btn btn-success form-control"><strong>Add</strong></button>
                {%else%}
                    <button type="submit" name="update" class="btn btn-success form-control"><strong>Update</strong></button>
                {%endif%}
            </div>
        </form>

    </div>


</div>

{% endblock content %}